name: Android Build

on:
  push:
    branches: [ "**" ]
  pull_request:
    branches: [ "**" ]
  workflow_dispatch:

jobs:
  build:
    name: Build APK
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17' # –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–µ—Ä—Å–∏—è JDK —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –≤–∞—à–∏–º AGP/Gradle

      # >>> –í–ê–ñ–ù–û: –î–æ–±–∞–≤–ª–µ–Ω —à–∞–≥ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Android SDK <<<
      - name: Set up Android SDK
        uses: android-actions/setup-android@v3 # –ò—Å–ø–æ–ª—å–∑—É–µ–º v3, —Ç–∞–∫ –∫–∞–∫ v2 —É—Å—Ç–∞—Ä–µ–ª–∞
        # –í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å 'with' –±–ª–æ–∫ –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –≤–µ—Ä—Å–∏–π, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
        # with:
        #   api-level: 34 # –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –ø–æ–¥ API 34
        #   build-tools: "34.0.0" # –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è Build Tools
        #   ndk: "25.2.9519653" # –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ NDK
        #   cmake: "3.22.1"   # –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ CMake

      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew

      # üßπ –£–¥–∞–ª–µ–Ω–∏–µ –∫—ç—à–∞ Gradle –≤—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –±—ã–ª –ø–æ–≤—Ä–µ–∂–¥—ë–Ω) - –û–°–¢–û–†–û–ñ–ù–û
      # –≠—Ç–æ—Ç —à–∞–≥ –º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å —Å–±–æ—Ä–∫—É, —Ç–∞–∫ –∫–∞–∫ –∫—ç—à –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å—Å—è.
      # –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∫—ç—à–µ–º.
      # –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ actions/cache –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è Gradle.
      # - name: Remove Gradle caches manually 
      #   run: rm -rf $HOME/.gradle/caches 

      - name: Clean build directory
        run: ./gradlew clean

      - name: Print app dependencies
        run: ./gradlew :app:dependencies --configuration debugCompileClasspath

      - name: Build with Gradle
        run: ./gradlew assembleDebug
        # –î–ª—è –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π —Å–±–æ—Ä–∫–∏ —Ä–µ–ª–∏–∑–Ω–æ–π –≤–µ—Ä—Å–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å signing config):
        # run: ./gradlew assembleRelease
